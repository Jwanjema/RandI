# Render Deployment Guide

## Quick Deploy to Render

This guide will help you deploy your Rental Management System to Render.com in minutes.

---

## Prerequisites

1. A [Render account](https://render.com) (free tier available)
2. Your code pushed to a GitHub repository
3. PostgreSQL database (provided free by Render)

---

## Option 1: Deploy with render.yaml (Recommended)

### Step 1: Push Code to GitHub

```bash
# Initialize git if not already done
git init

# Add all files
git add .

# Commit changes
git commit -m "Prepare for Render deployment"

# Add remote and push (replace with your repo URL)
git remote add origin https://github.com/yourusername/rental-system.git
git push -u origin main
```

### Step 2: Deploy on Render

1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click **"New"** â†’ **"Blueprint"**
3. Connect your GitHub repository
4. Render will automatically detect `render.yaml` and create:
   - PostgreSQL database
   - Django backend web service
   - React frontend static site

### Step 3: Configure Environment Variables

The backend service needs these environment variables (some are auto-generated):

**Auto-configured:**
- `DATABASE_URL` - Automatically set by Render
- `SECRET_KEY` - Auto-generated secure key

**You need to set:**
- `ALLOWED_HOSTS` - Add your backend URL: `your-backend-name.onrender.com`
- `CORS_ALLOWED_ORIGINS` - Add your frontend URL: `https://your-frontend-name.onrender.com`
- `CSRF_TRUSTED_ORIGINS` - Add both backend and frontend URLs

### Step 4: Update Frontend Environment Variable

After backend is deployed:
1. Go to your frontend service on Render
2. Update `REACT_APP_API_URL` to: `https://your-backend-name.onrender.com/api`
3. Trigger a manual deploy

---

## Option 2: Manual Deployment

### Step 1: Deploy PostgreSQL Database

1. Go to Render Dashboard
2. Click **"New"** â†’ **"PostgreSQL"**
3. Fill in:
   - **Name**: `rental-db`
   - **Database**: `rental_db`
   - **User**: `rental_user`
   - **Region**: Choose closest to you
   - **Plan**: Free
4. Click **"Create Database"**
5. Copy the **Internal Database URL** (starts with `postgresql://`)

### Step 2: Deploy Django Backend

1. Click **"New"** â†’ **"Web Service"**
2. Connect your GitHub repository
3. Fill in:
   - **Name**: `rental-backend`
   - **Region**: Same as database
   - **Branch**: `main`
   - **Root Directory**: Leave blank
   - **Runtime**: `Python 3`
   - **Build Command**: `./build.sh`
   - **Start Command**: `cd backend && gunicorn rental_system.wsgi:application`
   - **Plan**: Free

4. **Add Environment Variables** (click "Advanced"):
   ```
   DATABASE_URL = <paste-internal-database-url>
   SECRET_KEY = <generate-random-50-char-string>
   DEBUG = False
   ALLOWED_HOSTS = rental-backend.onrender.com
   DJANGO_SETTINGS_MODULE = rental_system.settings
   PYTHON_VERSION = 3.11.9
   ```

5. Click **"Create Web Service"**

### Step 3: Deploy React Frontend

1. Click **"New"** â†’ **"Static Site"**
2. Connect your GitHub repository
3. Fill in:
   - **Name**: `rental-frontend`
   - **Branch**: `main`
   - **Root Directory**: Leave blank
   - **Build Command**: `cd frontend && npm install && npm run build`
   - **Publish Directory**: `frontend/build`

4. **Add Environment Variable**:
   ```
   REACT_APP_API_URL = https://rental-backend.onrender.com/api
   ```

5. Click **"Create Static Site"**

### Step 4: Update Backend CORS Settings

After frontend is deployed:
1. Go to your backend service
2. Update environment variables:
   ```
   CORS_ALLOWED_ORIGINS = https://rental-frontend.onrender.com
   CSRF_TRUSTED_ORIGINS = https://rental-frontend.onrender.com,https://rental-backend.onrender.com
   ```
3. Click **"Save Changes"** (this will trigger a redeploy)

---

## Post-Deployment Steps

### 1. Create Superuser

Use Render Shell to create an admin account:

1. Go to your backend service on Render
2. Click **"Shell"** in the top right
3. Run:
   ```bash
   cd backend
   python manage.py createsuperuser
   ```
4. Follow prompts to create admin account

### 2. Seed Initial Data (Optional)

```bash
cd backend
python manage.py create_users
python manage.py seed_data
```

### 3. Test Your Application

1. Visit your frontend URL: `https://rental-frontend.onrender.com`
2. Try logging in with the superuser credentials
3. Test creating buildings, units, and tenants

---

## Environment Variables Reference

### Backend Service

| Variable | Description | Example |
|----------|-------------|---------|
| `DATABASE_URL` | PostgreSQL connection string | Auto-generated by Render |
| `SECRET_KEY` | Django secret key | Generate 50+ random characters |
| `DEBUG` | Debug mode (always False) | `False` |
| `ALLOWED_HOSTS` | Allowed hostnames | `rental-backend.onrender.com` |
| `CORS_ALLOWED_ORIGINS` | Frontend URLs for CORS | `https://rental-frontend.onrender.com` |
| `CSRF_TRUSTED_ORIGINS` | Trusted origins for CSRF | `https://rental-frontend.onrender.com,https://rental-backend.onrender.com` |
| `DJANGO_SETTINGS_MODULE` | Settings module | `rental_system.settings` |
| `PYTHON_VERSION` | Python version | `3.11.9` |

### Frontend Service

| Variable | Description | Example |
|----------|-------------|---------|
| `REACT_APP_API_URL` | Backend API URL | `https://rental-backend.onrender.com/api` |
| `NODE_VERSION` | Node.js version | `18.17.0` |

---

## Troubleshooting

### Backend Won't Start

1. **Check logs**: Click "Logs" tab on your backend service
2. **Common issues**:
   - Missing environment variables
   - Database connection issues
   - Dependency installation failures

3. **Fix**:
   ```bash
   # In Render Shell
   cd backend
   pip install -r requirements.txt
   python manage.py migrate
   ```

### Frontend Shows API Errors

1. **Verify CORS settings** in backend environment variables
2. **Check REACT_APP_API_URL** in frontend environment variables
3. **Ensure backend is running** before testing frontend

### Static Files Not Loading

1. **Check build.sh executed**:
   ```bash
   python manage.py collectstatic --no-input
   ```

2. **Verify WhiteNoise** is in requirements.txt and MIDDLEWARE

### Database Connection Failed

1. **Check DATABASE_URL** is correct (use Internal URL from database page)
2. **Ensure database and backend are in same region**
3. **Verify PostgreSQL database is running**

### Free Tier Limitations

- **Backend/Database spins down after 15 min of inactivity**
- First request after spin-down takes ~30 seconds
- **750 hours/month free** (enough for 1 service running 24/7)
- **Upgrade to paid plan** for:
  - Always-on services
  - Custom domains
  - More resources

---

## Updating Your Deployment

### When You Make Code Changes

```bash
# Commit and push changes
git add .
git commit -m "Your changes description"
git push origin main
```

Render will automatically:
1. Detect the push
2. Run build command
3. Deploy new version

### Manual Deploy

1. Go to your service on Render
2. Click **"Manual Deploy"** â†’ **"Deploy latest commit"**

### Database Migrations

After model changes:

1. Push code to GitHub
2. Backend will auto-deploy and run migrations (in build.sh)
3. Or manually in Shell:
   ```bash
   cd backend
   python manage.py makemigrations
   python manage.py migrate
   ```

---

## Custom Domain (Optional)

### For Backend

1. Go to backend service â†’ Settings
2. Scroll to **Custom Domain**
3. Add: `api.yourdomain.com`
4. Follow DNS configuration instructions
5. Update frontend `REACT_APP_API_URL`

### For Frontend

1. Go to frontend service â†’ Settings
2. Scroll to **Custom Domain**
3. Add: `yourdomain.com` or `www.yourdomain.com`
4. Follow DNS configuration instructions
5. Update backend CORS/CSRF settings

---

## Monitoring and Logs

### View Logs
1. Go to your service
2. Click **"Logs"** tab
3. See real-time logs

### Metrics
1. Click **"Metrics"** tab
2. View:
   - CPU usage
   - Memory usage
   - Request count
   - Response times

### Alerts
1. Go to Settings
2. Add email for deploy notifications
3. Configure failure alerts

---

## Cost Optimization

### Free Tier
- 1 PostgreSQL database (free forever)
- 750 hours web service/month
- 100 GB bandwidth/month
- Static sites unlimited (free)

### Recommendations
- Use 1 backend service (combines Django API)
- Deploy frontend as static site (free)
- Database on free tier (sufficient for small apps)

**Total: $0/month** for basic usage!

### Paid Options
- **Starter** ($7/month): Always-on, more resources
- **Standard** ($25/month): Autoscaling, better performance
- **Pro** ($85/month): High availability, dedicated resources

---

## Security Checklist

- [x] `DEBUG = False` in production
- [x] Strong `SECRET_KEY` (50+ characters)
- [x] `ALLOWED_HOSTS` properly configured
- [x] CORS origins restricted to your frontend
- [x] HTTPS enabled (automatic on Render)
- [x] Database uses strong password (auto-generated)
- [x] Environment variables for sensitive data

---

## Support

- **Render Docs**: https://render.com/docs
- **Community Forum**: https://community.render.com
- **Status Page**: https://status.render.com

---

## Success! ðŸŽ‰

Your Rental Management System should now be live at:
- **Frontend**: `https://rental-frontend.onrender.com`
- **Backend API**: `https://rental-backend.onrender.com/api`
- **Admin Panel**: `https://rental-backend.onrender.com/admin`

Login with your superuser credentials and start managing properties!
